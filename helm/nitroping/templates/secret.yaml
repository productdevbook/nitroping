{{- if not .Values.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "nitroping.fullname" . }}
  labels:
    {{- include "nitroping.labels" . | nindent 4 }}
  annotations:
    {{- if .Values.cnpg.enabled }}
    # DATABASE_URL is built from the CNPG cluster -rw service.
    # The CNPG operator also creates a secret named "<cluster>-app" that
    # contains the connection string â€” use existingSecret to reference it directly
    # instead of building the URL here.
    helm.sh/note: "cnpg-managed-postgres"
    {{- end }}
type: Opaque
stringData:
  DATABASE_URL: {{ include "nitroping.databaseUrl" . | quote }}
  REDIS_HOST: {{ include "nitroping.redisHost" . | quote }}
  REDIS_PORT: {{ include "nitroping.redisPort" . | quote }}
  JWT_SECRET: {{ required "config.jwtSecret is required" .Values.config.jwtSecret | quote }}
  ENCRYPTION_KEY: {{ required "config.encryptionKey is required" .Values.config.encryptionKey | quote }}
  WEBHOOK_SECRET: {{ required "config.webhookSecret is required" .Values.config.webhookSecret | quote }}
  RATE_LIMIT_DEFAULT: {{ .Values.config.rateLimitDefault | quote }}
  RATE_LIMIT_WINDOW: {{ .Values.config.rateLimitWindow | quote }}
  RATE_LIMIT_DISABLED: {{ .Values.config.rateLimitDisabled | quote }}
  SCHEDULER_ENABLED: {{ .Values.config.schedulerEnabled | quote }}
  NITRO_HOST: "0.0.0.0"
  {{- if .Values.config.smtp.host }}
  SMTP_HOST: {{ .Values.config.smtp.host | quote }}
  SMTP_PORT: {{ .Values.config.smtp.port | quote }}
  SMTP_USER: {{ .Values.config.smtp.user | quote }}
  SMTP_PASS: {{ .Values.config.smtp.password | quote }}
  {{- end }}
{{- end }}
